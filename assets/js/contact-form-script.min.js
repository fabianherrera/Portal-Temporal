$("#contactForm").validator().on("submit", function (event) {
    if (event.isDefaultPrevented()) {
        // handle the invalid form...
        formError();
        submitMSG(false, "Debe completar la información requerida...");
    } else {
        // everything looks good!
        event.preventDefault();
        // submitForm();
        sendEmail(); //SMTPJS Functionality

    }
});



function sendEmail() {
    // Initiate Variables With Form Content
    var name = $("#name").val();
    var email = $("#email").val();
    var subject = $("#subject").val();
    var message = $("#message").val();
    var title = $("#title").val();
    var subscribe = $('#subscribe')[0].checked;
    var date = new Date();
    date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear();
    var msg_body = "<html><h2>Nuevo mensaje recibido</h2><br>" +
        "Este mensaje ha sido generado desde el formulario de contacto del portal orbisnetwork.com.ve:<br><br>" +
        "<strong>Fecha:  " + date + ". </strong><br><br>" + 
        "<strong>Asunto:  </strong>" + subject + " <br><br>" +
        "<strong>Nombre:  </strong>" + name + " <br><br>" +
        "<strong>E-Mail:  </strong>" + email + " <br><br>" +
        "<strong>Subscribeme:  </strong>" + subscribe + " <br><br>" +
        "<strong>Título:  </strong>" + title + " <br><br>" +
        "<strong>Mensaje:</strong><br><br> " + message + "<br><br><br>" +
        "<small>Disclaimer:<br>The information sent with this e-mail message is only for the strict use of the intended recipient. In the event that this e-mail message is incomplete in any way, the recipient is kindly requested to contact the sender of this message. It is not permitted to publish, copy, circulate and/or disclose any of this information to third parties without the permission of Orbis Network. If you are not the intended recipient of and are in possession of this e-mail message, please notify us immediately, delete the e-mail message from your inbox, and do not use it for any purpose or disclose the contents of this message to third parties, or publish, copy or store this information on an information carrier.</small></html>"

    Email.send({
        SecureToken: "ab27bfc5-7ae7-4cf5-9bfb-216a60901fc9",
        To: 'fabian.herrera@orbisnetwork.com.ve',
        From: "contact@orbisnetwork.com.ve",
        Subject: title,
        Body: msg_body,
    })
        .then( message => compose_response_message(message)
           // message => alert(message)
        );

}

function compose_response_message (message) {
    if (message == "OK") {
        formSuccess();
    } else {
        formError();
        submitMSG(false, message);
    }
}


// function submitForm(){
//     // Initiate Variables With Form Content
//     var name = $("#name").val();
//     var email = $("#email").val();
//     var msg_subject = $("#msg_subject").val();
//     var message = $("#message").val();
//     var title = $("#title").val();

//     $.ajax({
//         type: "POST",
//         url: "assets/php/form-process.php",
//         data: "name=" + name + "&email=" + email + "&msg_subject=" + msg_subject + "&title=" + title + "&message=" + message,
//         success : function(text){
//             if (text == "success"){
//                 formSuccess();
//             } else {
//                 formError();
//                 submitMSG(false,text);
//             }
//         }
//     });
// }

function formSuccess(){
    $("#contactForm")[0].reset();
    submitMSG(true, "Mensaje enviado exitosamente.");
}

function formError(){
    $("#contactForm").removeClass().addClass('shake animated').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function(){
        $(this).removeClass();
    });
}

function submitMSG(valid, msg){
    if(valid){
        var msgClasses = "h3 text-center tada animated text-success";
    } else {
        var msgClasses = "h3 text-center text-danger";
    };
    $("#msgSubmit").removeClass().addClass(msgClasses).text(msg);
}